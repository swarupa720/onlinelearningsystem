{% extends "base.html" %}
{% load static %}

{% block title %}Available Courses{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">🌐 Available Courses</h2>

    {% if all_courses %}
        <div class="row g-4">
            {% for course in all_courses %}
                {% if request.user not in course.enrolled_students.all %}
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">{{ course.title }}</h5>
                                <p class="card-text text-muted">{{ course.description|truncatewords:20 }}</p>
                                <p class="text-muted small">👤 By: {{ course.created_by.username }}</p>

                                <a href="{% url 'courses:course-detail' course.id %}" class="btn btn-dark btn-sm">🔍 View</a>

                                {% if course.created_by == request.user %}
                                    <a href="{% url 'courses:edit_course' course.id %}" class="btn btn-warning btn-sm ms-2">✏️ Edit</a>
                                    <a href="{% url 'courses:delete_course' course.id %}" 
                                       class="btn btn-danger btn-sm ms-2"
                                       onclick="return confirm('Are you sure you want to delete this course? This action cannot be undone!');">
                                       🗑️ Delete
                                    </a>
                                {% endif %}

                                {% if request.user.role == 'student' %}
                                    <a href="{% url 'courses:enroll-course' course.id %}" 
                                       class="btn btn-success btn-sm ms-2"
                                       onclick="return confirm('Do you want to enroll in this course?');">
                                       ✅ Enroll
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">No courses available at the moment.</p>
    {% endif %}

    <!-- ✅ Back Button -->
    <div class="mt-4">
        {% if request.user.role == 'student' %}
            <a href="{% url 'users:student_dashboard' %}" class="btn btn-secondary">⬅ Back to Dashboard</a>
        {% elif request.user.role == 'faculty' %}
            <a href="{% url 'users:faculty_dashboard' %}" class="btn btn-secondary">⬅ Back to Dashboard</a>
        {% endif %}
    </div>
</div>
{% endblock %}
