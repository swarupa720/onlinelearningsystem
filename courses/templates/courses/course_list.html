{% load static %}
{% load custom_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ course.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="dashboard-body">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
    <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'courses:course_list' %}">ğŸŒŸ LearningSystem</a>
        <div class="ms-auto text-white d-flex align-items-center">
            Welcome, {{ request.user.username }}
            <form method="POST" action="{% url 'logout' %}" class="ms-3">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-logout">ğŸšª Logout</button>
            </form>
        </div>
    </div>
</nav>

<!-- Main Course Container -->
<div class="container dashboard-container py-5">
    <div class="card dashboard-card shadow-lg p-4 mb-4">
        <h1 class="mb-3 course-title">{{ course.title }}</h1>

        <!-- Badges -->
        <div class="row mb-3">
            <div class="col">
                <span class="badge custom-badge bg-secondary me-2">ğŸ“š Total Lessons: {{ total }}</span>
                <span class="badge custom-badge bg-success me-2">âœ… Completed: {{ completed }}</span>
                <span class="badge custom-badge bg-info text-dark">ğŸ“Š Progress: {{ progress_percent }}%</span>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress progress-custom mb-4" style="height: 25px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" 
                 style="width: {{ progress_percent }}%;" 
                 aria-valuenow="{{ progress_percent }}" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
                {{ progress_percent }}%
            </div>
        </div>

        <!-- Lesson List -->
        <h4 class="section-title mb-3">ğŸ“– Lessons</h4>
        {% if lessons %}
            <ul class="list-group list-group-flush">
                {% for lesson in lessons %}
                    <li class="list-group-item d-flex justify-content-between align-items-center lesson-item">
                        <div>
                            <a href="{% url 'courses:lesson-detail' lesson.id %}" class="lesson-link fw-semibold">
                                {{ lesson.title }}
                            </a>
                            {% if lesson.id|id_in_list:completed_ids %}
                                <span class="badge bg-success ms-2">âœ… Completed</span>
                            {% else %}
                                <span class="badge bg-warning text-dark ms-2">âŒ Incomplete</span>
                            {% endif %}
                        </div>
                        <div>
                            {% if lesson.course.created_by == request.user %}
                                <a href="{% url 'courses:delete_lesson' lesson.id %}" 
                                   class="btn btn-sm btn-danger">
                                    ğŸ—‘ï¸ Delete Lesson
                                </a>
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="alert alert-info mt-3">
                ğŸš¨ No lessons found for this course.
            </div>
        {% endif %}

        <!-- Delete Course Button -->
        {% if course.created_by == request.user %}
            <div class="mt-4">
                <a href="{% url 'courses:delete_course' course.id %}" class="btn btn-danger">
                    ğŸ—‘ï¸ Delete Entire Course
                </a>
            </div>
        {% endif %}
    </div>
</div>

</body>
</html>
